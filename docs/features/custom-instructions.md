# 自定义指令

自定义指令允许您个性化 Roo 的行为，提供具体指导以塑造其响应、编码风格和决策过程。

:::info 指令文件位置
您可以使用全局规则（适用于所有项目）、工作区规则（项目特定）或通过“提示”选项卡界面提供自定义指令。

**全局规则目录：** 自动应用于所有项目。
*   **Linux/macOS:** `~/.roo/rules/` 和 `~/.roo/rules-{modeSlug}/`
*   **Windows:** `%USERPROFILE%\.roo\rules\` 和 `%USERPROFILE%\.roo\rules-{modeSlug}\`

**工作区规则：** 仅应用于当前项目，可以覆盖全局规则。
*   **首选方法：目录 (`.roo/rules/`)**
    ```
    .
    ├── .roo/
    │   └── rules/          # 工作区范围的规则
    │       ├── 01-general.md
    │       └── 02-coding-style.txt
    └── ... (其他项目文件)
    ```
*   **备用方法：单个文件 (`.roorules`)**
    ```
    .
    ├── .roorules           # 工作区范围的规则 (单个文件)
    └── ... (其他项目文件)
    ```

**特定模式指令：** 仅应用于特定模式（例如 `code`）。
*   **首选方法：目录 (`.roo/rules-{modeSlug}/`)**
    ```
    .
    ├── .roo/
    │   └── rules-code/     # "code" 模式的规则
    │       ├── 01-js-style.md
    │       └── 02-ts-style.md
    └── ... (其他项目文件)
    ```
*   **备用方法：单个文件 (`.roorules-{modeSlug}`)**
    ```
    .
    ├── .roorules-code      # "code" 模式的规则 (单个文件)
    └── ... (其他项目文件)
    ```

规则按以下顺序加载：首先是全局规则，然后是工作区规则（可以覆盖全局规则）。有关详细信息，请参阅[全局规则目录](#全局规则目录)。
:::

---

## 什么是自定义指令？

自定义指令定义了超出 Roo 基本角色定义的特定行为、偏好和约束。示例包括编码风格、文档标准、测试要求和工作流指南。

---

## 设置自定义指令

### 全局自定义指令

这些指令适用于所有工作区，无论您在哪个项目中工作，都能保持您的偏好。

**如何设置：**

<img src="/img/custom-instructions/custom-instructions.png" alt="Roo Code 提示选项卡显示全局自定义指令界面" width="600" />
1.  **打开提示选项卡：** 点击 Roo Code 顶部菜单栏中的 <Codicon name="notebook" /> 图标
2.  **找到部分：** 找到“所有模式的自定义指令”部分
3.  **输入指令：** 在文本区域输入您的指令
4.  **保存更改：** 点击“完成”以保存您的更改

### 全局规则目录

全局规则目录功能提供可重用的规则和自定义指令，可自动应用于您的所有项目。该系统支持全局配置和项目特定覆盖。

#### 主要优点

**没有全局规则**：您必须在每个项目中维护单独的规则文件：
- 将相同的规则复制到每个新项目中
- 在多个项目中手动更新规则
- 项目之间没有一致性

**使用全局规则**：一次创建规则，随处使用：
- 全局设置您偏好的编码标准
- 需要时可按项目覆盖特定规则
- 在所有工作中保持一致性
- 轻松一次性更新所有项目的规则

#### 目录结构

全局规则目录位置是固定的，无法自定义：

**Linux/macOS:**
```
~/.roo/                           # 您的全局 Roo 配置
├── rules/                        # 应用于所有项目的通用规则
│   ├── coding-standards.md
│   ├── formatting-rules.md
│   └── security-guidelines.md
├── rules-code/                   # 特定于代码模式的规则
│   ├── typescript-rules.md
│   └── testing-requirements.md
├── rules-docs-extractor/         # 用于文档提取的规则
│   └── documentation-style.md
└── rules-{mode}/                 # 其他特定模式的规则
    └── mode-specific-rules.md
```

**Windows:**
```
%USERPROFILE%\.roo\               # 您的全局 Roo 配置
├── rules\                        # 应用于所有项目的通用规则
│   ├── coding-standards.md
│   ├── formatting-rules.md
│   └── security-guidelines.md
├── rules-code\                   # 特定于代码模式的规则
│   ├── typescript-rules.md
│   └── testing-requirements.md
└── rules-{mode}\                 # 其他特定模式的规则
    └── mode-specific-rules.md
```

#### 设置全局规则

1. **创建全局规则目录：**
   ```bash
   # Linux/macOS
   mkdir -p ~/.roo/rules
   
   # Windows
   mkdir %USERPROFILE%\.roo\rules
   ```

2. **添加通用规则** (`~/.roo/rules/coding-standards.md`):
   ```markdown
   # 全局编码标准
   
   1. 新项目始终使用 TypeScript
   2. 为所有新函数编写单元测试
   3. 使用描述性的变量名
   4. 为公共 API 添加 JSDoc 注释
   ```

3. **添加特定模式规则** (`~/.roo/rules-code/typescript-rules.md`):
   ```markdown
   # TypeScript 代码模式规则
   
   1. 在 tsconfig.json 中使用严格模式
   2. 对对象形状优先使用接口而非类型别名
   3. 始终为函数指定返回类型
   ```

#### 可用的规则目录

| 目录 | 用途 |
|-----------|---------|
| `rules/` | 应用于所有模式的通用规则 |
| `rules-code/` | 特定于代码模式的规则 |
| `rules-docs-extractor/` | 用于文档提取的规则 |
| `rules-architect/` | 用于系统架构任务的规则 |
| `rules-debug/` | 用于调试工作流的规则 |
| `rules-{mode}/` | 用于任何自定义模式的规则 |

#### 规则加载顺序

规则按此顺序加载：

1. **全局规则** (来自 `~/.roo/`)
2. **项目规则** (来自 `project/.roo/`) - 可以覆盖全局规则
3. **旧版文件** (`.roorules`, `.clinerules` - 用于向后兼容)

在每个级别内，特定模式的规则在通用规则之前加载。

### 工作区级别指令

这些指令仅在您当前的工作区内应用，允许您为特定项目自定义 Roo Code 的行为。

#### 通过文件/目录设置工作区范围的指令

工作区范围的指令应用于当前项目中的所有模式，并可以使用文件定义：

*   **首选方法：基于目录 (`.roo/rules/`)**
    *   在您的工作区根目录中创建一个名为 `.roo/rules/` 的目录。
    *   将指令文件（例如 `.md`, `.txt`）放入其中。Roo Code 会递归读取文件，并根据文件名按**字母顺序**将其内容附加到系统提示中。
    *   如果目录存在且包含文件，则此方法优先。
*   **备用方法：基于文件 (`.roorules`)**
    *   如果 `.roo/rules/` 不存在或为空，Roo Code 会在工作区根目录中查找单个 `.roorules` 文件。
    *   如果找到，则加载其内容。

#### 特定模式指令

特定模式的指令可以通过两种可以同时使用的独立方式进行设置：

1.  **使用提示选项卡：**

    <img src="/img/custom-instructions/custom-instructions-2.png" alt="Roo Code 提示选项卡显示特定模式自定义指令界面" width="600" />
    * **打开选项卡：** 点击 Roo Code 顶部菜单栏中的 <Codicon name="notebook" /> 图标
    * **选择模式：** 在“模式”标题下，点击您想要自定义的模式按钮
    * **输入指令：** 在“特定模式自定义指令（可选）”下的文本区域输入您的指令
    * **保存更改：** 点击“完成”以保存您的更改

        :::info 全局模式规则
        如果模式本身是全局的（非工作区特定），您为其设置的任何自定义指令也将在所有工作区中对该模式全局应用。
        :::

2.  **使用规则文件/目录：** 通过文件提供特定模式的指令：
    *   **首选方法：基于目录 (`.roo/rules-{modeSlug}/`)**
        *   在您的工作区根目录中创建一个名为 `.roo/rules-{modeSlug}/` 的目录（例如 `.roo/rules-docs-writer/`）。
        *   将指令文件放入其中（递归加载）。文件按文件名**字母顺序**读取并附加到系统提示中。
        *   如果目录存在且包含文件，则此方法优先于特定模式的备用文件方法。
    *   **备用方法：基于文件 (`.roorules-{modeSlug}`)**
        *   如果 `.roo/rules-{modeSlug}/` 不存在或为空，Roo Code 会在工作区根目录中查找单个 `.roorules-{modeSlug}` 文件（例如 `.roorules-code`）。
        *   如果找到，则为该模式加载其内容。

来自提示选项卡、全局规则、工作区规则和特定模式规则的指令都会被合并。有关确切顺序，请参阅以下部分。

---

## 指令如何合并

指令按以下确切格式放置在系统提示中：

```
====
用户的自定义指令

用户提供了以下附加指令，应在不干扰工具使用指南的情况下尽力遵循。

[语言偏好（如果设置）]

[全局指令（来自提示选项卡）]

[特定模式指令（来自当前模式的提示选项卡）]

全局规则 (来自 ~/.roo/):
[~/.roo/rules-{modeSlug}/ 中文件的内容（如果目录存在且不为空）]
[~/.roo/rules/ 中文件的内容（如果目录存在且不为空）]

特定模式指令 (来自文件/目录):
[.roo/rules-{modeSlug}/ 中文件的内容（如果目录存在且不为空）]
[.roorules-{modeSlug} 文件的内容（如果 .roo/rules-{modeSlug}/ 不存在或为空，且文件存在）]

工作区范围指令 (来自文件/目录):
[.roo/rules/ 中文件的内容（如果目录存在且不为空）]
[.roorules 文件的内容（如果 .roo/rules/ 不存在或为空，且文件存在）]

====
```

*注意：全局规则首先加载，然后是可以覆盖它们的工作区规则。在每个级别内，特定模式的规则出现在通用规则之前，并且基于目录的规则优先于基于文件的备用方法。*

---

## 关于 .rules 文件的规则

* **文件位置：** 首选方法使用 `.roo/` 内的目录（`.roo/rules/` 和 `.roo/rules-{modeSlug}/`）。备用方法使用直接位于工作区根目录中的单个文件（`.roorules` 和 `.roorules-{modeSlug}`）。
* **空文件：** 空的或缺失的规则文件会被静默跳过
* **来源标题：** 每个规则文件的内容都包含一个指示其来源的标题
* **规则交互：** 特定模式的规则补充而不是替换全局规则

---

## 自定义指令示例

* "始终使用空格进行缩进，宽度为 4 个空格"
* "对变量名使用驼峰命名法"
* "为所有新函数编写单元测试"
* "在提供代码之前解释你的推理"
* "关注代码的可读性和可维护性"
* "优先使用社区中最常见的库"
* "向网站添加新功能时，确保它们是响应式和可访问的"

:::tip 专业提示：团队标准化
对于团队环境，请考虑以下方法：

**项目标准**：使用受版本控制的工作区 `.roo/rules/` 目录来标准化特定项目的 Roo 行为。这确保了团队成员之间一致的代码风格和开发工作流。

**组织标准**：使用全局规则 (`~/.roo/rules/`) 来建立适用于所有项目的组织范围的编码标准。团队成员可以设置相同的全局规则，以在所有工作中保持一致性。

**混合方法**：将用于组织标准的全局规则与用于项目特定要求的工作区规则相结合。需要时，工作区规则可以覆盖全局规则。

基于目录的方法比单个 `.roorules` 文件提供了更好的组织性，并支持全局和项目级别的自定义。
:::

---

## 与自定义模式结合

为了进行高级自定义，可与[自定义模式](/features/custom-modes)结合，以创建具有特定工具访问权限、文件限制和量身定制指令的专门环境。
