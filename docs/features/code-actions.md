# 代码操作

代码操作通过 VSCode 的灯泡（快速修复）系统，让您直接在代码编辑器中即时获得 Roo Code 的 AI 辅助。这一上下文感知功能会自动检测相关的代码情境，并提供适当的 AI 驱动操作，无需您切换到聊天界面。

---

## 什么是代码操作？

代码操作在编辑器边栏（行号左侧区域）显示为一个灯泡图标 (💡)。它们也可以通过右键上下文菜单或键盘快捷键访问。它们在以下情况下被触发：

*   您选择了一个代码范围。
*   您的光标位于有问题（错误、警告或提示）的行上。
*   您通过命令调用它们。

单击灯泡图标、右键单击并选择“Roo Code”，或使用键盘快捷键（默认为 `Ctrl+.` 或在 macOS 上为 `Cmd+.`），会显示一个可用操作的菜单。

---

## Roo Code 的代码操作

Roo Code 提供 5 种代码操作，但它们的可用性因上下文而异：

### 上下文菜单操作 (右键单击)
*   **添加到上下文：** 快速将所选代码添加到与 Roo 的聊天中，包括文件名和行号，以便 Roo 确切知道代码的来源。它在菜单中列在首位，方便访问。
*   **解释代码：** 要求 Roo Code 解释所选代码。
*   **改进代码：** 要求 Roo Code 对所选代码提出改进建议。

### 其他操作
*   **修复代码：** 可通过灯泡菜单和命令面板使用（但不在右键菜单中）。要求 Roo Code 修复所选代码中的问题。
*   **新任务：** 使用所选代码创建一个新任务。可通过命令面板使用。

### 上下文感知操作
灯泡菜单会根据您代码的当前状态智能地显示不同的操作：

**对于有问题的代码** (当 VSCode 显示红色/黄色波浪线时):
- **修复代码** - 获取解决特定错误或警告的分步指导
- **添加到上下文** - 将有问题的代码添加到 Roo 的上下文中进行讨论

**对于干净的代码** (无诊断信息):
- **解释代码** - 获取关于代码功能的详细解释
- **改进代码** - 接收优化建议和最佳实践
- **添加到上下文** - 将代码添加到 Roo 的上下文中以进行后续工作

### “添加到上下文”深度解析

**添加到上下文** 操作在代码操作菜单中列在首位，以便您可以快速将代码片段添加到对话中。当您使用它时，Roo Code 会将文件名和行号与代码一起包含进来。

这有助于 Roo 理解您代码在项目中的确切上下文，从而提供更相关、更准确的辅助。

**聊天输入示例：**

```
你能解释一下这个函数吗？
@myFile.js:15:25
```

*(其中 `@myFile.js:15:25` 代表通过“添加到上下文”添加的代码)*

---

## 使用代码操作

有三种主要方式来使用 Roo Code 的代码操作：

### 1. 通过灯泡图标 (💡)

1.  **选择代码：** 选择您想要处理的代码。您可以选择单行、多行或整个代码块。
2.  **寻找灯泡图标：** 一个灯泡图标将出现在所选代码（或有错误/警告的行）旁边的边栏中。
3.  **单击灯泡图标：** 单击灯泡图标以打开代码操作菜单。
4.  **选择一个操作：** 从菜单中选择所需的 Roo Code 操作。
5.  **审查和批准：** Roo Code 将在聊天面板中提出解决方案。审查建议的更改并批准或拒绝它们。

### 2. 通过右键上下文菜单

1.  **选择代码：** 选择您想要处理的代码。
2.  **右键单击：** 在所选代码上右键单击以打开上下文菜单。
3.  **选择 "Roo Code"：** 从上下文菜单中选择 "Roo Code" 选项。一个子菜单将出现，其中包含可用的 Roo Code 操作。
4.  **选择一个操作：** 从子菜单中选择所需的操作。
5.  **审查和批准：** Roo Code 将在聊天面板中提出解决方案。审查建议的更改并批准或拒绝它们。

### 3. 通过命令面板

1.  **选择代码：** 选择您想要处理的代码。
2.  **打开命令面板：** 按 `Ctrl+Shift+P` (Windows/Linux) 或 `Cmd+Shift+P` (macOS)。
3.  **输入命令：** 输入 "Roo Code" 以筛选命令，然后选择相关的代码操作（例如，“Roo Code: 解释代码”）。该操作将在最合乎逻辑的上下文中应用（通常是当前活动的聊天任务，如果存在的话）。
4.  **审查和批准：** Roo Code 将在聊天面板中提出解决方案。审查建议的更改并批准或拒绝它们。

---

## 终端操作

Roo Code 也为终端输出提供类似的操作：

*   **终端：添加到上下文：** 将选定的终端输出添加到您的聊天中
*   **终端：修复命令：** 要求 Roo Code 修复失败的终端命令
*   **终端：解释命令：** 要求 Roo Code 解释终端输出或命令

当您在终端中选择文本并右键单击时，这些操作可用。

---

## 禁用/启用代码操作

您可以通过 VSCode 设置来控制代码操作：

### 启用/禁用代码操作
- **设置**: [`roo-cline.enableCodeActions`](vscode://settings/roo-cline.enableCodeActions)
- **默认值**: 已启用
- **描述**: 控制 Roo Code 快速修复选项是否出现在编辑器中

要访问此设置：
1. 打开 VSCode 设置 (`Ctrl/Cmd + ,`)
2. 搜索 "enableCodeActions"
3. 切换复选框以启用或禁用

---

## 自定义代码操作提示

您可以通过修改 **Prompts** 选项卡中的“Support Prompts”来自定义每个代码操作使用的提示。这使您可以微调给予 AI 模型的指令，并根据您的特定需求定制响应。

1.  **打开 Prompts 选项卡：** 单击 Roo Code 顶部菜单栏中的 <Codicon name="notebook" /> 图标。
2. **找到 "Support Prompts"：** 您将看到支持提示，包括“Enhance Prompt”、“Explain Code”、“Improve Code”和“Fix Code”。
3. **编辑提示：** 在您想要自定义的提示的文本区域中修改文本。提示使用 `${placeholder}` 格式的占位符：
    - `${filePath}` - 当前文件的路径
    - `${selectedText}` - 当前选定的文本
    - `${diagnostics}` - 任何错误或警告消息（用于修复代码）
4. **单击 "Done"：** 保存您的更改。

### 示例提示模板
```
请解释以下来自 ${filePath} 的代码：

${selectedText}
```

通过使用 Roo Code 的代码操作，您可以直接在编码工作流程中快速获得 AI 驱动的辅助。这可以节省您的时间，并帮助您编写更好的代码。
