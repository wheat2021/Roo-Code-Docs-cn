# new_task

`new_task` 工具可以在保持父子关系的同时，使用专门的模式创建子任务。它将复杂的项目分解为可管理的部分，每个部分都在最适合特定工作的模式下运行。

---

## 参数

该工具接受以下参数：

- `mode` (必需): 新任务启动时所用模式的标识符 (例如, "code", "ask", "architect")
- `message` (必需): 此新任务的初始用户消息或指令

---

## 功能

此工具使用指定的启动模式和初始消息创建一个新的任务实例。它允许将复杂的工作流划分为具有各自对话历史的子任务。在子任务执行期间，父任务会暂停，并在子任务完成时恢复，结果会传回给父任务。

---

## 使用场景

- 当需要将复杂项目分解为独立的、专注的子任务时
- 当任务的不同方面需要不同的专门模式时
- 当工作的不同阶段受益于上下文分离时
- 当组织多阶段开发工作流时

---

## 主要特性

- 使用其自身的对话历史和专门模式创建子任务
- 暂停父任务以便稍后恢复
- 维护用于导航的层级任务关系
- 完成后将结果传回父任务
- 支持复杂项目的工作流隔离
- 允许项目的不同部分使用为特定工作优化的模式
- 创建任务需要用户明确批准
- 在用户界面中提供清晰的任务转换

---

## 限制

- 无法使用不存在的模式创建任务
- 每次创建新任务前都需要用户批准
- 对于深度嵌套的子任务，任务界面可能会变得复杂
- 子任务会从父任务继承某些工作区和扩展配置
- 在深度嵌套的任务之间切换时，可能需要重新建立上下文
- 任务完成需要明确的信号才能正确返回到父任务

---

## 工作原理

当调用 `new_task` 工具时，它遵循以下流程：

1.  **参数验证**:
    -   验证必需的 `mode` 和 `message` 参数
    -   验证所请求的模式在系统中是否存在

2.  **任务堆栈管理**:
    -   维护一个任务堆栈，跟踪所有活动和暂停的任务
    -   保留当前模式以便稍后恢复
    -   将父任务设置为暂停状态

3.  **任务上下文管理**:
    -   使用提供的消息创建一个新的任务上下文
    -   分配唯一的 taskId 和 instanceId 标识符用于状态管理
    -   捕获有关工具使用和任务生命周期的遥测数据

4.  **模式切换与集成**:
    -   切换到具有适当角色和功能的指定模式
    -   使用提供的消息初始化新任务
    -   与 VS Code 的命令面板和代码操作集成

5.  **任务完成与结果传递**:
    -   当子任务完成时，结果通过 `finishSubTask()` 传回父任务
    -   父任务以其原始模式恢复
    -   更新任务历史和令牌使用指标
    -   发出 `taskCompleted` 事件，并附带性能数据

---

## 使用示例

- 当一名前端开发人员需要架构一个新功能、实现代码并编写文档时，他们可以为每个阶段创建单独的任务，并将结果从一个阶段流向下一个阶段。
- 在实施修复之前调试问题时，调试任务可以记录发现，这些发现将被传递给实施任务。
- 在开发全栈应用程序时，来自架构师模式任务的数据库模式设计为后续代码模式任务中的实施细节提供了信息。
- 在实施后为系统编写文档时，文档任务可以引用已完成的实施，同时使用特定于文档的功能。

---

## 用法示例

在代码模式下创建一个新任务：
```
<new_task>
<mode>code</mode>
<message>实现一个用户认证服务，包括登录、注册和密码重置功能。</message>
</new_task>
```

完成实施后创建一个文档任务：
```
<new_task>
<mode>docs</mode>
<message>为我们刚刚构建的认证服务创建全面的 API 文档。</message>
</new_task>
```

将一个复杂功能分解为架构规划和实施：
```
<new_task>
<mode>architect</mode>
<message>为我们的新电子商务平台设计数据库模式和系统架构。</message>
</new_task>
