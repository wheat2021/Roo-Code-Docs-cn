# switch_mode

`switch_mode` 工具使 Roo 能够在不同的操作模式之间切换，每种模式都针对特定类型的任务具备专门的功能。这使得当当前任务需要不同专业知识时，可以在代码（Code）、架构师（Architect）、问答（Ask）或调试（Debug）等模式之间无缝过渡。

---

## 参数

该工具接受以下参数：

- `mode_slug` (必需): 要切换到的模式的标识符 (例如, "code", "ask", "architect")
- `reason` (可选): 切换模式的原因，为用户提供上下文

---

## 功能

当当前任务更适合由另一种模式的功能来处理时，此工具会请求更改模式。它在保持上下文的同时，调整 Roo 的焦点和可用工具集，以匹配新任务阶段的要求。

---

## 使用时机

- 从信息收集过渡到代码实现时
- 从编码转向架构或设计时
- 当当前任务需要的功能仅在不同模式下可用时
- 当复杂项目的特定阶段需要专门的专业知识时

---

## 主要特性

- 在模式转换过程中保持上下文的连续性
- 为模式切换建议提供清晰的理由
- 所有模式更改都需要用户批准
- 强制执行每种模式特定的工具组限制
- 根据所选模式无缝调整工具的可用性
- 支持标准模式和自定义模式
- 在用户界面中显示模式切换及其原因
- 使用 XML 风格的格式指定参数
- 处理特定于某些模式的文件类型限制

---

## 限制

- 无法切换到系统中不存在的模式
- 每次模式转换都需要明确的用户批准
- 在切换完成之前无法使用特定于模式的工具
- 模式切换后会应用 500 毫秒的延迟，以使更改生效
- 某些模式有文件类型限制 (例如, 架构师模式只能编辑 Markdown 文件)
- 模式保留以供恢复仅适用于 `new_task` 功能，不适用于常规的模式切换

---

## 工作原理

调用 `switch_mode` 工具时，它会遵循以下流程：

1.  **请求验证**:
    -   验证请求的模式是否存在于系统中
    -   检查 `mode_slug` 参数是否已提供且有效
    -   验证用户是否尚未处于请求的模式中
    -   确保 `reason` 参数 (如果提供) 格式正确

2.  **模式转换准备**:
    -   将模式更改请求与提供的理由打包
    -   向用户呈现更改请求以供批准

3.  **模式激活 (用户批准后)**:
    -   更新用户界面以反映新模式
    -   根据模式的工具组配置调整可用工具
    -   应用特定于模式的提示和行为
    -   应用 500 毫秒的延迟，以在执行下一个工具之前使更改生效
    -   强制执行特定于该模式的任何文件限制

4.  **继续**:
    -   使用新模式的功能继续执行任务
    -   保留来自先前交互的相关上下文

---

## 工具组关联

`switch_mode` 工具属于 "modes" 工具组，但也包含在 "始终可用" 的工具列表中。这意味着：

-   无论模式配置的工具组如何，它都可以在任何模式下使用
-   它可以与 `ask_followup_question` 和 `attempt_completion` 等其他核心工具一起使用
-   当任务需求发生变化时，它允许在工作流程的任何时间点进行模式转换

---

## 模式结构

系统中的每个模式都有特定的结构：

-   `slug`: 模式的唯一标识符 (例如, "code", "ask")
-   `name`: 模式的显示名称 (例如, "代码", "问答")
-   `roleDefinition`: 模式的专业角色和功能
-   `customInstructions`: 可选的特定于模式的指令，用于指导行为
-   `groups`: 模式可用的工具组，带有可选限制

---

## 模式功能

核心模式提供以下专业功能：

-   **代码模式**: 专注于编码任务，可以完全访问代码编辑工具
-   **架构师模式**: 专门用于系统设计和架构规划，仅限于编辑 Markdown 文件
-   **问答模式**: 优化用于回答问题和提供信息
-   **调试模式**: 用于系统化的问题诊断和解决

---

## 自定义模式

除了核心模式外，系统还支持特定于项目的自定义模式：

-   可以定义启用特定工具组的自定义模式
-   它们可以指定自定义的角色定义和指令
-   系统会首先检查自定义模式，然后再回退到核心模式
-   具有相同标识符的自定义模式定义优先于核心模式

---

## 文件限制

不同的模式可能有特定的文件类型限制：

-   **架构师模式**: 只能编辑匹配 `.md` 扩展名的文件
-   尝试编辑受限文件类型会导致 `FileRestrictionError`
-   这些限制有助于在模式之间强制执行适当的关注点分离

---

## 使用示例

-   在讨论新功能时，Roo 从问答模式切换到架构师模式，以帮助设计系统结构。
-   在架构师模式下完成架构规划后，Roo 切换到代码模式以实现设计的功能。
-   在开发过程中遇到错误时，Roo 从代码模式切换到调试模式进行系统化的故障排除。

---

## 用法示例

切换到代码模式进行实现：
```
<switch_mode>
<mode_slug>code</mode_slug>
<reason>需要根据我们讨论的架构来实现登录功能</reason>
</switch_mode>
```

切换到架构师模式进行设计：
```
<switch_mode>
<mode_slug>architect</mode_slug>
<reason>在实现之前需要设计系统架构</reason>
</switch_mode>
```

切换到调试模式进行故障排除：
```
<switch_mode>
<mode_slug>debug</mode_slug>
<reason>需要系统地诊断身份验证错误</reason>
</switch_mode>
```

切换到问答模式获取信息：
```
<switch_mode>
<mode_slug>ask</mode_slug>
<reason>需要回答有关已实现功能的问题</reason>
</switch_mode>
